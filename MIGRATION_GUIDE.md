# راهنمای Migration دیتابیس

## اجرای Migration

برای اعمال تغییرات دیتابیس (افزودن جداول اشتراک، پرداخت، و رده‌بندی):

```bash
npx prisma migrate dev --name add_subscriptions_leaderboard
```

یا اگر می‌خواهید migration را به صورت دستی ایجاد کنید:

```bash
npx prisma migrate dev --create-only
```

سپس فایل migration ایجاد شده را ویرایش کنید و اجرا کنید:

```bash
npx prisma migrate dev
```

## ساختار جداول جدید

### SubscriptionPlan
- مدیریت پلن‌های اشتراک
- شامل: نام، قیمت، مدت زمان، ویژگی‌ها

### Subscription
- اشتراک‌های کاربران
- شامل: وضعیت، تاریخ شروع/پایان، تجدید خودکار

### Payment
- پرداخت‌های کاربران
- شامل: مبلغ، وضعیت، روش پرداخت، شناسه تراکنش

### Leaderboard
- رده‌بندی کاربران
- شامل: امتیاز کل، تعداد آزمون‌ها، رتبه

## نکات مهم

1. **قبل از Migration**: از دیتابیس خود بکاپ بگیرید
2. **پس از Migration**: `npx prisma generate` را اجرا کنید
3. **تست**: پس از migration، سیستم را تست کنید

## رفع مشکلات

### خطای اتصال به دیتابیس
- مطمئن شوید PostgreSQL در حال اجرا است
- بررسی کنید `DATABASE_URL` در `.env` صحیح است

### خطای Schema
- بررسی کنید تمام فیلدهای required پر شده‌اند
- مطمئن شوید روابط (relations) به درستی تعریف شده‌اند

